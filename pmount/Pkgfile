# Description: mount removable devices as normal user
# URL:         http://pmount.alioth.debian.org/
# Maintainer:  doom, dm <at> archlinux <dot> info
# Packager:    doom, dm <at> archlinux <dot> info
# Depends on:  sysfsutils util-linux

name=pmount
version=0.9.23
release=1
source=(
  https://alioth.debian.org/frs/download.php/3310/${name}-${version}.tar.bz2
  'http://anonscm.debian.org/gitweb/?p=pmount/pmount-debian.git;a=blob_plain;f=debian/completion/pmount'
  https://alioth.debian.org/tracker/download.php/31157/412979/313576/4753/fix-pmount-segfault.diff
)

build() {
  export CFLAGS="${CFLAGS} -fPIE -pie"
  export CXXFLAGS="${CXXFLAGS} -fPIE -pie"
  cd $name-$version
  patch -Np1 -i $SRC/fix-pmount-segfault.diff
  ./configure --prefix=/usr --disable-hal \
    --with-cryptsetup-prog=/usr/sbin/cryptsetup --datarootdir=/usr
  make

  make DESTDIR="$PKG" install
  mkdir -p $PKG/media
  rm -rf $PKG/usr/share/locale
}
